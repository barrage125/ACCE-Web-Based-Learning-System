@using System.Text.RegularExpressions;

@{
    var section = ViewData["section"] as ACE_Web_Based_Learning_System.Models.Section;
    var capacity = section.Capacity;
    var sectionID = section.ID;
    sectionID = Regex.Replace(sectionID, "[A-Za-z ]", "");
    var enrolledCourse = section.Course.CourseName;
    var students = section.enrollments;
    var userContent = Session["UserContent"] as ACE_Web_Based_Learning_System.Models.UserContent;
    var userColor = userContent.Color ?? "Black";
    var courses = Session["Courses"] as List<ACE_Web_Based_Learning_System.Models.Course>
    ;
    var courseContent = ViewData["CourseContent"] as List<ACE_Web_Based_Learning_System.Models.CourseContent>;
    Layout = "~/Views/Shared/_Layout.cshtml";
    var i = 0;

    var tests = ViewData["Tests"] as List<TestQuestions>;
    var testsAttempts = ViewData["TestsAttempts"] as List<ACE_Web_Based_Learning_System.Models.TestAttempt>;
    }
<style>
    .mdl-list__item:hover {
        background-color: lightgray;
    }
    .userCard {
        display: flex;
        flex-direction: column;
        width: 300px;
        text-align: center;
        color: black;
        font-size: 18px;
    }

    .userInfo {
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
    }

    .dropdown-menu-center {
        right: auto;
        left: 17%;
        -webkit-transform: translate(-83%, 5%);
        -o-transform: translate(-83%, 5%);
        transform: translate(-83%, 5%);
    }

    .userButton {
        background-color: transparent;
        border-top-style: solid;
        border-width: 1px;
        padding-top: 10px;
        border-color: lightgray;
        margin-top: 10px;
        cursor: pointer;
    }

    .mdl-layout__drawer .mdl-navigation .mdl-navigation__link {
        color: black !important;
    }
</style>
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-tabs" ">
    <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
            <!-- Title -->
            <span class="mdl-layout-title">@enrolledCourse @sectionID</span>
            <!-- Add spacer, to align navigation to the right -->
            <div class="mdl-layout-spacer"></div>
            <!-- Navigation. We hide it in small screens. -->
            <nav class="mdl-navigation mdl-layout--large-screen-only">

                <div class="dropdown">
                    <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        <span class="material-icons" style="color: @userColor">face</span>

                    </button>
                    <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="dropdownMenu1">
                        <li>
                            <div class="userCard">
                                <div class="userInfo">
                                    <span class="material-icons" style="font-size: 100px; color: @userColor">face</span>
                                    <div> @Model.FirstName  @Model.LastName</div>

                                    <div style="color: lightgray"> @userContent.Email</div>
                                </div>
                                <div id="manageButton" class="userButton">
                                    Manage your account settings
                                </div>
                                <div id="signOutButton" class="userButton">
                                    Sign out
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
            <a href="#fixed-tab-1" class="mdl-layout__tab is-active">Content</a>
            <a href="#fixed-tab-2" class="mdl-layout__tab">Grades</a>
            <a href="#fixed-tab-3" class="mdl-layout__tab">Students</a>
        </div>
    </header>
    <div class="mdl-layout__drawer">
        <span class="material-icons" style="font-size: 100px; text-align:center; color:@userColor">face</span>
        <div style="text-align:center; padding-bottom: 20px;  border-bottom-style: solid; border-width: 1px"> @Model.FirstName  @Model.LastName</div>

        <nav class="mdl-navigation">
            @foreach (var course in courses)
            {
                <a class="mdl-navigation__link" href="/Course/CourseView?courseNumber=@course.CourseNo"><span class="mdl-badge" data-badge="4">@course.CourseName</span></a>
            }





        </nav>
    </div>
    <main class="mdl-layout__content">
        <section class="mdl-layout__tab-panel is-active" id="fixed-tab-1">
            <div class="page-content">
                <h1> Welcome to @enrolledCourse! </h1>
                <div class="panel-group" id="accordion">
                    <div class="panel panel-default">
                     
                        @foreach (var content in courseContent)
                        {
                            i++;
                                    <div class="panel-heading">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion" href="#@i">
                                    Course Material #@i
                                </a>
                            </h4>
                        </div>
                        <div id = "@i" class="panel-collapse collapse in">
                            <div class="panel-body">
                                @content.Content
                            </div>
                        </div>
             
                        }



                </div>
            </div>
                </div>
        </section>
        <section class="mdl-layout__tab-panel" id="fixed-tab-2">
            <div class="page-content">
                <div class="panel-group" id="accordion1">
                    <div class="panel panel-default">

                        @for (int j = 0; j < tests.Count; j++)

                        {
                            <div class="panel-heading">
                                <h4 class="panel-title" style="text-align:center">
                                    <a data-toggle="collapse" aria-expanded="false" data-parent="#accordion1" href="#@(j+1000)" class="collapsed">
                                        Test #@j
                                    </a>
                                </h4>
                            </div>
                            <div id="@(j+1000)" aria-expanded="false" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <button class="testQuestion" onclick="takeTest(@j)">
                                        Take Test
                                    </button>
                                </div>
                            </div>
                        }





                    </div>
                </div>
                <div class="panel-group" id="accordion2">
                    <div class="panel panel-default">

                        @for (int k = 0; k < testsAttempts.Count; k++)

                        {
                            <div class="panel-heading">
                                <h4 class="panel-title" style="text-align:center">
                                    <a data-toggle="collapse" aria-expanded="false" data-parent="#accordion2" href="#@(k+5000)" class="collapsed">
                                        Test #@k
                                    </a>
                                </h4>
                            </div>
                            <div id="@(k+5000)" aria-expanded="false" class="panel-collapse collapse">
                                <div class="panel-body">
                                   @testsAttempts[k].ANSWERS
                                </div>
                            </div>
                        }





                    </div>
                </div>


            </div>
        </section>
        <section class="mdl-layout__tab-panel" id="fixed-tab-3">
            <div class="page-content">
                <div style="width: 100%; display: flex; flex-direction:row; justify-content:space-around">
                    <h3> Students</h3>
                    <h3> @students.Count / @capacity</h3>
                </div>
                <ul class="demo-list-icon mdl-list">
                    @foreach (var enrollment in students)
                    {
                        var status = enrollment.User.UserContent.Status ?? "No status avaliable";
                        <li class="mdl-list__item" style="cursor:pointer; " onclick="showUserInfo('@enrollment.User.UserContent.Color', '@enrollment.User.FirstName  @enrollment.User.LastName', '@status', '@enrollment.User.UserContent.Email')">
                            <span class="mdl-list__item-primary-content">
                                <i class="material-icons mdl-list__item-icon" style="color:@enrollment.User.UserContent.Color">face</i>
                                @enrollment.User.FirstName @enrollment.User.LastName

                            </span>
                            <span class="mdl-list__item-secondary-content" style="font-style:italic">
                                @status
                            </span>
                        </li>
                    }


                </ul>
            </div>
        </section>



    </main>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script>
        document.getElementById("manageButton").addEventListener("click", function () {


            window.location.href = "/User/UserSettings";



        });
        document.getElementById("signOutButton").addEventListener("click", function () {


            window.location.href = "/User/LoginPage";



        });
        function showUserInfo(color, name, status, email) {

            Swal.fire({
                title: name,
                icon: 'info',
                iconHtml: '<i class="material-icons mdl-list__item-icon" style="color:' + color +'">face</i>',
                html: email + "<br><br>" + "<span style='font-style:italic'>" +status,
                    
                    
                showCloseButton: true,
                showCancelButton: true,
                confirmButtonText:
                    '<a href ="mailto:'+email+'" target="_blank"><i class="material-icons mdl-list__item-icon" style="color:white">message</i></a>',
                confirmButtonAriaLabel: 'Message',
                cancelButtonText:
                    '<i class="material-icons mdl-list__item-icon" style="color:white">clear</i>',
                focusConfirm: false,

            })
        }
        function takeTest(j)
        {
            window.location.href = "TestView?courseNumber=" + @courseContent[0].Course.CourseNo + "&testNo=" + j;
            
        }
    </script>
